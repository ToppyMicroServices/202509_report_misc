# Release package (20250914_1100)

This package organizes **data, figures, and code** used in the US–JP credit externalization analysis.

## Folders
- `figures/` — final figures for the manuscript.
- `data_raw/` — raw public inputs (as available locally).
- `data_processed/` — processed series used to generate figures.
- `code/` — Python scripts to reproduce figures or compute series.
- `manifests/` — machine-readable manifest.
- `docs/` — this README and method notes.

## Provenance & Reproducibility
- All figures were programmatically generated from public datasets using Python (pandas, numpy, matplotlib).
- **No generative AI or AI-assisted tools were used to create or alter any images.**
- If any raw file is missing, replace it with the original source file using the same filename.

## Known conventions
- Study window: 2012–2025 (quarterly). Trailing zero-pad rows (if any) are trimmed in processed series.
- US k-decomposition: **term (WAM) held constant at 360m**; term contribution is set to 0. See code comments.
- Units are noted in filenames or figure captions (e.g., MBS/GDP as %).

### Naming / provenance conventions (2025Q3+)

| Category | Prefix Pattern | Example | Meaning |
|----------|----------------|---------|---------|
| Figure scripts | `fig_codeNN_` | `fig_code06_SCATTER_US_DSR_vs_CreditGrowth_FINAL.png` | Output generated by figure script `fig_code06_...` |
| Processing scripts | `proc_codeNN_` | `proc_code02_JP_phi_quarterly.csv` | Deterministic processed dataset generated by `proc_codeNN` script |
| Fetch scripts (py/sh) | `fetch_codeNN_` | `fetch_code07_imf_jp_gdp.py` | Data acquisition script |
| Fetch output (JSDA RMBS) | `fetch_code03_` | `fetch_code03_JSDA_RMBS_components.csv` | Parsed semiannual JSDA RMBS components |
| Fetch output (CET1 combine) | `fetch_code01_` | `fetch_code01_CET1_RWA_WB_combined.csv` | Combined CET1/RWA US+JP (postprocess) |
| Fetch output (JHF xls→xlsx) | `fetch_code02_` | `fetch_code02_nme_R031.2985528.xlsx` | Converted factor workbook (source .xls retained) |
| Fetch output (US MBS+GDP) | `fetch_code05_` | `fetch_code05_US_MBS_GDP_quarterly.csv` | Merged quarterly MBS outstanding & GDP |
| Fetch output (ESRI JP GDP opt) | `fetch_code06_` | `fetch_code06_JP_ESRI_GDP_quarterly.csv` | Optional legacy ESRI GDP |
| Fetch output (IMF JP GDP) | `fetch_code07_` | `fetch_code07_JP_IMF_GDP_quarterly.csv` | Primary JP nominal GDP source |
| DSR panels (US/JP) | `proc_code03_` | `proc_code03_US_DSR_CreditGrowth_panel.csv` | Standardized panel (DSR_pct, CreditGrowth_ppYoY) |
| k decomposition | `proc_code01_` | `proc_code01_k_decomposition_JP_quarterly.csv` | Trimmed / cleaned k contribution panel |
| φ series build | `proc_code02_` | `proc_code02_JP_phi_from_JSDA_cleaned_quarterly_DEDUP.csv` | Reconstructed φ series provenance |
| Annual MBS/RMBS ratios | `proc_code05_` | `proc_code05_US_MBS_to_NGDP_annual.csv` | Annual ratios (replaces legacy US_MBS_to_AnnualGDP.csv etc.) |

Rules:
1. Every figure or processed artifact is traceable to its generating script via filename prefix.
2. When a new prefixed file exists, legacy unprefixed filenames remain acceptable as fallbacks during a transition window (scripts attempt prefixed → legacy).
3. Processed panels are stable filenames (no numeric suffix) to ease downstream reproducibility; figures may auto-suffix to avoid overwriting.
4. Date indices in processed panel CSVs are explicit first column (quarter-end) for time alignment.

New in this release: `proc_code03_build_dsr_creditgrowth_panels.py` generates `proc_code03_US_DSR_CreditGrowth_panel.csv` and `proc_code03_JP_DSR_CreditGrowth_panel.csv`. The orchestration script (`fig_code08_graph.sh`) invokes this builder so downstream scatter / dual-panel / time-series figures use prefixed provenance-aware panels automatically.

## Data fetch architecture (2025 refresh)
- JP nominal quarterly GDP: PRIMARY source `fetch_code07_imf_jp_gdp.py` (IMF IFS NGDP via SDMX). Run with:
	`python code/fetch_code07_imf_jp_gdp.py --start 2012 --end 2025`
- Legacy ESRI fallback: `fetch_code06_esri_jp_gdp.py` (manual URL; auto-discovery retained but unreliable). Use only for cross-checks.
- Generic FRED single-series fetch: `fetch_code08_fred_series.py` (used by verification figure scripts to decouple network logic).
- Legacy scratch fetch functions formerly embedded in `util_code99_tmp.py` have been isolated to `fetch_code09_legacy_tmp_extracts.py` and will be removed later.

### Quarter handling / deprecation notes
Pandas deprecated some legacy quarterly frequency strings; scripts now normalize dates to quarter-end using PeriodIndex (`to_period('Q').to_timestamp('Q')`) instead of `resample('Q')` where practical to reduce warnings. Remaining `'Q'` tokens are internal constants and not passed to resample with deprecated semantics.

## How to reproduce
1. Inspect `data_processed/` and `code/` scripts for expected inputs.
2. Use canonical scripts:
	- Data fetch: `python code/fetch_code01_capital_k_data.py --years 2018-2024` (optional; requires internet)
	- Figures individually: `python code/fig_code0X_*.py` (01–08)
	- Batch QC examples: `bash code/fig_code08_graph.sh`
3. Compare SHA-256 sums in the manifest for integrity.

### Canonical figure scripts (summary)
| Code | Script | Description |
|------|--------|-------------|
| 01 | fig_code01_jsda_components.py | JSDA semiannual housing components |
| 02 | fig_code02_mbs_to_gdp.py | US vs JP MBS/RMBS to GDP (single axis) |
| 03 | fig_code03_mbs_to_gdp_dual_axis.py | Dual-axis MBS/RMBS vs GDP |
| 04 | fig_code04_phi_offbalance.py | φ off-balance (detailed) |
| 05 | fig_code05_phi_offbalance_simple.py | φ off-balance (simple) |
| 06 | fig_code06_scatter_dsr_creditgrowth.py | DSR vs Credit Growth scatter/OLS |
| 07 | fig_code07_k_decomp_generic.py | k decomposition generic plot |
| 08 | fig_code08_graph.sh | Batch QC example wrapper (shell) |
| 09 | fig_code09_jp_jhf_rmbs_vs_gdp.py | JP JHF RMBS vs GDP ratio (uses processed inputs) |

### Verification / diagnostics
- `fig_code10_verify_us_phi_sources.py` uses `fetch_code08_fred_series.py` to download and reconcile US φ components; produces adjusted vs raw series and a report.

### Scratch / legacy
- `scratch_code99_lab_cli.py` (replacing former util_code99_tmp) is a minimal, DEPRECATED lab CLI; remove after 2025Q4.

